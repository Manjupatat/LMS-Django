{% extends "base.html" %}
{% block title %}{{ course.name }} - LMS{% endblock %}
{% block content %}
<!--<a href="{% url 'courses' %}" class="btn btn-secondary">Back to Courses</a>-->
<h2>{{ course.name }}</h2>
<p>{{ course.description }}</p>
<!-- Enroll Button or Enrolled Badge -->
{% if enrolled %}
    <span class="badge bg-success">Enrolled</span>
{% else %}
    <form method="POST" action="{% url 'enroll_course' course.id %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">Enroll Now</button>
    </form>
{% endif %}

<hr>


<h2>Syllabus</h2>
<!--<ul>-->
<!--  {% for lesson in lessons %}-->
<!--    <li>{{ lesson.title }}</li>-->
<!--  {% empty %}-->
<!--    <li>No lessons available for this course.</li>-->
<!--  {% endfor %}-->
<!--</ul>-->


<div class="mb-3">
    <h5>Course Progress</h5>
    <div class="progress" style="height: 20px;">
        <div class="progress-bar bg-success" role="progressbar" style="width: {{ progress_percent }}%;" aria-valuenow="{{ progress_percent }}" aria-valuemin="0" aria-valuemax="100">
            {{ progress_percent }}%
        </div>
    </div>
</div>


<div class="container mt-4">
  <div class="row">

    <!-- Sidebar with Lessons -->
    <div class="col-md-3">
      <div class="card">
        <div class="card-header bg-primary text-white">Lessons</div>
        <div class="list-group list-group-flush">
          {% for lesson in course.lessons.all %}
          <div class="list-group-item">
            <h6 class="mb-1">{{ lesson.title }}</h6>
            {% if lesson in user_progress.completed_lessons.all %}
              <span class="badge bg-success">Completed</span>
            {% elif lesson.id == current_lesson.id %}
              <form method="POST" action="{% url 'mark_lesson_complete' lesson.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-primary mt-1">Mark as Complete</button>
              </form>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Main Content Area: Current Lesson Video -->
    <div class="col-md-9">
      <h4>{{ current_lesson.title }}</h4>
      <div class="ratio ratio-16x9">
        <iframe src="{{ current_lesson.video_url }}" style="width:950px;height:450px;"
                title="Lesson Video" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin"
                allowfullscreen
                frameborder="0">
        </iframe>
      </div>
      <div class="mt-3">
        <p>{{ current_lesson.content }}</p>
      </div>

          <div class="navigation d-flex justify-content-between mt-4">
        {% if prev_lesson %}
        <a href="{% url 'course_detail_lesson' course.id prev_lesson.id %}" class="btn btn-primary">Previous Lesson</a>
        {% else %}
        <div></div>
         {% endif %}

      {% if next_lesson %}
        <a href="{% url 'course_detail_lesson' course.id next_lesson.id %}" class="btn btn-primary">Next Lesson</a>
        {% else %}
        <div></div>
        {% endif %}
    </div>
</div>
  </div>
</div>


{% endblock %}



